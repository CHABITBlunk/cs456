version: "4.0"

networks:
  blue_team_net:
    driver: bridge
    name: blue_team_net

services:
  dvwa:
    image: vulnerables/web-dvwa:latest
    container_name: dvwa
    networks:
      - blue_team_net
    depends_on:
      - dvwa_db
    ports:
      - "8081:80"
    restart: unless-stopped
    volumes:
      - ./log/apache2:/var/log/apache2
      - ./log/dvwa:/var/www/html/log
    environment:
      - MYSQL_HOST="dvwa_db"
      - MYSQL_USER="dvwa"
      - MYSQL_PASSWORD="dvwa"
      - MYSQL_DATABASE="dvwa"
      - APACHE_SERVERNAME="localhost"
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"

  dvwa_db:
    image: mysql:5.7
    container_name: dvwa_db
    networks:
      - blue_team_net
    environment:
      - MYSQL_ROOT_PASSWORD="rootpassword"
      - MYSQL_DATABASE="dvwa"
      - MYSQL_USER="dvwa"
      - MYSQL_PASSWORD="dvwa"
    volumes:
      - dvwa_db_data:/var/lib/mysql
      - ./log/dvwa_db:/var/log/mysql
    restart: unless-stopped
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"

  cowrie:
    image: cowrie/cowrie:latest
    container_name: cowrie
    networks:
      - blue_team_net
    ports:
      - "2222:2222"
    volumes:
      - ./cowrie/etc:/cowrie/etc
      - ./log/cowrie:/cowrie/log
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"
    restart: unless-stopped
    entrypoint: "/cowrie/cowrie-env/bin/twistd"
    command: ["-n", "cowrie"]

  smb:
    image: bsantanna/smb:latest
    container_name: smb
    hostname: smb
    environment:
      - NAME="Data"
      - USER="samba"
      - PASS="my_smb_s3rv3r"
    ports:
      - "445:445"
    volumes:
      - samba_storage:/storage
      - ./log/smb:/var/log/samba
      - ./smb.conf:/etc/samba/smb.conf
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"
    restart: always

volumes:
  dvwa_db_data:
  samba_storage:
  ./log/apache2:
  ./log/cowrie:
  ./log/dvwa:
  ./log/dvwa_db:
  ./log/smb:
